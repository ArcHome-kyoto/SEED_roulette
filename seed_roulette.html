<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SEED æŠ½é¸ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</title>
<style>
body {
    background: #f0f0f0;
    font-family: "Segoe UI", sans-serif;
    text-align: center;
}
#container {
    display: flex;
    justify-content: center;
    margin-top: 20px;
}
#left {
    width: 60%;
}
#right {
    width: 25%;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    height: 500px;
    overflow-y: auto;
}
#roulette {
    background: #333;
    border-radius: 50%;
    margin-bottom: 20px;
}
button {
    padding: 12px 25px;
    font-size: 18px;
    margin: 5px;
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background: #1976d2;
    color: #fff;
}
button:hover {
    background: #125ea5;
}

#memberArea {
    margin: 10px;
}
textarea {
    width: 90%;
    height: 80px;
}

#winnerPopup {
    position: fixed;
    top: 30%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 40px;
    background: #fff;
    padding: 30px 50px;
    border-radius: 20px;
    box-shadow: 0 0 30px rgba(0,0,0,0.3);
    opacity: 0;
    transition: 0.4s;
    pointer-events: none;
    z-index: 9999;
}

#nextBtn {
    display: none;
    margin-top: 15px;
}

</style>
</head>
<body>

<h1>SEED æŠ½é¸ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1>

å½“é¸äººæ•°ï¼š
<input id="winnersCount" type="number" value="1" min="1" style="width:80px; font-size:20px;">
<br><br>

<div id="memberArea">
    <h3>ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ </h3>
    <textarea id="memberInput" placeholder="ãƒ¡ãƒ³ãƒãƒ¼åã‚’æ”¹è¡Œã§å…¥åŠ›"></textarea><br>
    <button onclick="addMembers()">è¿½åŠ </button>
</div>

<div id="container">
    <div id="left">
        <canvas id="roulette" width="400" height="400"></canvas>
        <button id="startBtn" onclick="startDraw()">START</button>
        <button id="nextBtn" onclick="nextDraw()">æ¬¡ã¸</button>
    </div>

    <div id="right">
        <h3>å½“é¸è€…ä¸€è¦§</h3>
        <ul id="winnerList"></ul>
    </div>
</div>

<div id="winnerPopup"></div>

<script>
// ---------------------------
//  ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†
// ---------------------------
let members = [];
let winners = [];

function addMembers() {
    const lines = document.getElementById("memberInput").value.split("\n");
    lines.forEach(name => {
        name = name.trim();
        if (name) members.push(name);
    });
    document.getElementById("memberInput").value = "";
    drawRoulette();
}

// ---------------------------
//  æç”»
// ---------------------------
let currentIndex = 0;
let timer = null;

function drawRoulette() {
    const cvs = document.getElementById("roulette");
    const ctx = cvs.getContext("2d");
    ctx.clearRect(0,0,cvs.width,cvs.height);

    if (members.length === 0) return;

    ctx.fillStyle = "#333";
    ctx.beginPath();
    ctx.arc(200,200,180,0,Math.PI*2);
    ctx.fill();

    ctx.fillStyle = "white";
    ctx.font = "28px Arial";
    ctx.textAlign = "center";
    ctx.fillText(members[currentIndex], 200,210);
}

// ---------------------------
//  START â†’ å›è»¢
// ---------------------------
let targetCount = 1;
let finishedCount = 0;

function startDraw() {
    if (members.length === 0) {
        alert("ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“");
        return;
    }

    targetCount = parseInt(document.getElementById("winnersCount").value);
    if (targetCount <= 0) {
        alert("å½“é¸äººæ•°ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
    }

    winners = [];
    finishedCount = 0;
    document.getElementById("winnerList").innerHTML = "";

    runRoulette();
}

function runRoulette() {
    document.getElementById("startBtn").style.display = "none";
    document.getElementById("nextBtn").style.display = "none";

    timer = setInterval(() => {
        currentIndex = (currentIndex + 1) % members.length;
        drawRoulette();
    }, 70);

    const stopTime = 1500 + Math.random()*1500;
    setTimeout(stopRoulette, stopTime);
}

// ---------------------------
//  STOP â†’ å½“é¸å‡¦ç†
// ---------------------------
function stopRoulette() {
    clearInterval(timer);

    const winner = members[currentIndex];
    winners.push(winner);
    finishedCount++;

    showWinnerPopup(winner);

    members.splice(currentIndex,1); // é‡è¤‡ã‚’é¿ã‘ã‚‹

    document.getElementById("winnerList").innerHTML += `<li>${winner}</li>`;

    drawRoulette();

    // ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºï¼ˆâ‘¡Bï¼‰
    if (finishedCount < targetCount) {
        document.getElementById("nextBtn").style.display = "inline-block";
    } else {
        document.getElementById("startBtn").style.display = "inline-block";
    }
}

// ---------------------------
//  æ¬¡ã¸ï¼ˆâ‘¡Bï¼‰
// ---------------------------
function nextDraw() {
    if (members.length === 0) {
        alert("å…¨å“¡å½“é¸ã—ã¾ã—ãŸ");
        return;
    }
    document.getElementById("nextBtn").style.display = "none";
    runRoulette();
}

// ---------------------------
//  å½“é¸ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼ˆâ‘ Bï¼‰
// ---------------------------
function showWinnerPopup(name) {
    const popup = document.getElementById("winnerPopup");
    popup.innerText = `ğŸ‰ ${name} ã•ã‚“ å½“é¸ï¼ ğŸ‰`;
    popup.style.opacity = 1;

    setTimeout(() => {
        popup.style.opacity = 0;
    }, 1500);
}

drawRoulette();
</script>
</body>
</html>
